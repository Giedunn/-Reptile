## å‡ºç‰ˆç¤¾å¥½åƒå·²ç»å…³é—­äº†ï¼Œå°ç™½è¯·é—®å¤§ä½¬å¯ä»¥åˆ†äº«ä¸€ä¸‹å—ï¼Ÿä¸èƒœæ„Ÿæ¿€ åº¦ç›˜17793129123  åªèƒ½é€šè¿‡è¿™ä¸ªæ–¹å¼è”ç³»ä½ äº†ğŸ˜„

## å‰è¨€

å› ä¸ºç–«æƒ…å½±å“[æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾åœ¨çº¿é˜…è¯»å…è´¹](http://ebooks.cmanuf.com/)ï¼Œæ°å¥½å…¶åˆæœ‰å¤§é‡çš„è®¡ç®—æœºçš„å¥½ä¹¦ï¼Œæ‰€ä»¥å°±å¿ƒç”Ÿäº†æŠŠè®¡ç®—æœºæ–¹å‘çš„æ‰€æœ‰çš„ä¹¦éƒ½ä¸‹è½½ä¸‹æ¥çš„å¿µå¤´ã€‚

æ‹…å¿ƒç‰ˆæƒé—®é¢˜ï¼Œä¸å†åˆ†äº«é“¾æ¥ï¼Œçœ‹ç™¾åº¦äº‘çš„è®°å½•å·²ç»æœ‰5w+çš„ä¿å­˜ï¼Œè¯¥æ‹¿åˆ°çš„åŸºæœ¬éƒ½æ‹¿åˆ°äº†

## è§‚å¯Ÿ

éšä¾¿ç‚¹å¼€å‡ æœ¬ä¹¦ï¼Œæœ‰çš„å›¾ä¹¦æä¾›äº†pdfé˜…è¯»ï¼Œæœ‰çš„ä¹¦æä¾›äº†åœ¨çº¿webé˜…è¯»ã€‚ä¼°è®¡æ˜¯å› ä¸ºæœ‰çš„ä¹¦æ²¡æœ‰æ–‡å­—èµ„æ–™æ‰€ä»¥æ‰æä¾›äº†pdfé˜…è¯»ã€‚

### ä¸‹è½½PDFé˜…è¯»çš„å›¾ä¹¦

å¯¹äºpdfä¸‹è½½ï¼Œç¨å¾®è§‚å¯Ÿä¸‹è½½é“¾æ¥å¯ä»¥çŸ¥é“ï¼Œå…¶ä¸‹è½½é“¾æ¥çš„urlæ˜¯ç”±ISBN+ç‰ˆæ¬¡å·å†³å®šçš„ï¼Œæ„Ÿè°¢åŒå­¦cyræŠŠæ‰€æœ‰çš„å›¾ä¹¦çš„isbnå’Œç‰ˆæ¬¡å·éƒ½çˆ¬ä¸‹æ¥äº†ï¼Œå…·ä½“æ–¹æ³•è§‚å¯Ÿç½‘ç«™çš„æ¥å£å¤§æ¦‚å¯ä»¥çŸ¥é“ï¼Œç›²çŒœä¸éš¾ï¼ˆï¼ˆ

isbnå’Œç‰ˆæ¬¡å·çˆ¬ä¸‹æ¥ä»¥åå»é‡ï¼Œæ ¹æ®é“¾æ¥æ ¼å¼å°±å¯ä»¥ç”Ÿæˆä¸€ä»½é“¾æ¥åˆé›†ï¼Œç”¨idmæ‰¹é‡ä¸‹è½½ã€‚æ–‡ä»¶ä¸º[pdf.txt ](https://github.com/yqylh/-Reptile/blob/master/pdf.txt)ã€‚ä¸‹è½½å®Œä»¥åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥ç½‘ç«™å‘½åæ–‡ä»¶æ˜¯æŒ‰ç…§isbn+ç‰ˆæ¬¡å·å‘½åçš„ï¼Œè™½ç„¶æœ‰åˆ©äºä»–ä»¬çš„ç®¡ç†ï¼Œä½†æ˜¯ä¸ä¾‹å¦‚æˆ‘ä»¬æŸ¥æ‰¾å›¾ä¹¦ï¼Œäºæ˜¯è¯¥åŒå­¦ç»™äº†æˆ‘å¦å¤–ä¸€ä»½æ–‡ä»¶[pdf2.txt](https://github.com/yqylh/-Reptile/blob/master/pdf2.txt) å…¶å†…ä¸º æ¨ç®—å‡ºçš„æ–‡ä»¶å|ä¹¦åï¼Œäºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªè‡ªåŠ¨renameçš„[C++ç¨‹åº](https://github.com/yqylh/-Reptile/blob/master/rename.cpp)

```c++
    std::string s;
    while(std::getline(std::cin, s)) {
        std::cout << s.substr(0, s.find_first_of('|')) << std::endl;
        std::cout << s.substr(s.find_first_of('|') + 1, s.length() - s.find_first_of('|') - 1) << "\n";
        
        std::string oldName = "./pdf/" + s.substr(0, s.find_first_of('|')) + "_2.pdf";
        std::string newName = "./pdf/" + s.substr(s.find_first_of('|') + 1, s.length() - s.find_first_of('|') - 1) + ".pdf"; 
        if (!rename(oldName.c_str(), newName.c_str())) {
            std::cout << "rename success "<< std::endl;
        } else {
            std::cout << "rename error "<< std::endl;
        }
    }
```

è‡ªæ­¤ æ‰€æœ‰pdfæ ¼å¼çš„ä¹¦éƒ½å·²ç»ä¸‹è½½å®Œæ¯•äº†ï¼Œå…±611æœ¬31.9GBã€‚

### çˆ¬å–H5é˜…è¯»çš„å›¾ä¹¦

è®¡ç®—æœºæ–¹é¢çš„ä¹¦ä¸€å…±æœ‰1400æœ¬å·¦å³ï¼Œå…¶ä¸­pdfæœ‰611æœ¬ï¼Œé‚£å¤§çº¦æœ‰800æœ¬åªæä¾›H5é˜…è¯»çš„å›¾ä¹¦ï¼Œä¹‹æ‰€ä»¥æ–­å®šåªæä¾›H5ï¼Œæ˜¯å› ä¸ºè¿™äº›å›¾ä¹¦æ ¹æ®isbnå’Œç‰ˆæ¬¡å·ä¸‹è½½çš„è¯ä¼šæç¤ºæ— æƒé™ä¸‹è½½ã€‚é‚£ä¹ˆå°±æƒ³åŠæ³•æŠŠè¿™æœ¬ä¹¦çˆ¬å–ä¸‹æ¥ï¼Œè§‚å¯Ÿäº†å¾ˆä¹…å‘ç°æ²¡æœ‰ä»»ä½•æ¥å£å¯ä»¥æä¾›æˆ‘ä»¬ç›´æ¥ä¸‹è½½è¿™æœ¬ä¹¦çš„æ–‡æœ¬èµ„æºã€‚

é¦–å…ˆç‚¹å¼€ä¸€æœ¬ä¹¦çš„åœ¨çº¿é˜…è¯»é¡µé¢ï¼Œä»å·¦ä¾§çš„ç›®å½•å¼€å§‹ç‚¹ç« èŠ‚ä¼šå‘ç°ä»–ä¼šç»™ä¸€ä¸ªå«readbookçš„æ¥å£å‘é€è¯·æ±‚ï¼Œè¿™ä¸ªæ¥å£ä¼šæŠŠä¸€ä¸ªXHTMLå‘é€å›æ¥ï¼Œè€Œå…¶æ ¼å¼ä¸º

`www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/+id+/OEBPS/Text/chapter?.xhtml `

è¿™é‡Œé¢æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œä¸€ä¸ªæ˜¯idï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸²æ•°å­—ï¼Œå¦ä¸€ä¸ªæ˜¯chapter?.xhtmlã€‚éšç¼˜åœ¨ç½‘é¡µçš„ä»£ç æœç´¢äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå˜é‡åä¸º'ebookid'ï¼Œå…¶çš„å€¼å°±æ˜¯è¿™ä¸ªidï¼Œå¦ä¸€ä¸ªchapteråº”è¯¥æ˜¯ç« èŠ‚çš„ç¼–å·ã€‚

é‚£æ¥ä¸‹æ¥çš„é€»è¾‘å°±å¾ˆæ˜æ˜¾äº†

1. æ‰¾åˆ°æ‰€æœ‰H5é˜…è¯»çš„ä¹¦çš„id
2. æ‰¾åˆ°æ¯æœ¬ä¹¦çš„listï¼Œå³chapterï¼Ÿ
3. æ ¹æ®æ¯æœ¬ä¹¦listä¸‹è½½æ‰€æœ‰çš„XHTMLè¿æ¥æˆä¸€ä¸ªHTMLè¾“å‡º
4. ä¿®æ­£ï¼Œå¯¼å‡ºpdf

#### æ‰¾åˆ°æ‰€æœ‰H5é˜…è¯»çš„ä¹¦çš„id

ï¼ˆå¼€å§‹æ˜¯ç”±qeræ‰¾æ‰€æœ‰çš„H5ä¹¦çš„idï¼Œä½†æ˜¯ä¸çŸ¥é“ä»–çš„æ–¹æ³•æ˜¯å•¥ï¼Œæ‰æ‰¾äº†ä¸€ç‚¹å°±è¢«é™åˆ¶è®¿é—®äº†ï¼Œç»§ç»­é­å°¸qerï¼Œç”±äºæˆ‘é‡‡ç”¨çš„æ–¹æ³•ç›´æ¥è°ƒç”¨çš„æ˜¯é˜…è¯»ï¼Œä¸éœ€è¦ä»»ä½•éªŒè¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«é™åˆ¶è®¿é—®ï¼Œè€Œä¸”qerç»™æˆ‘çš„è¿˜æ˜¯æœ‰é‡å¤çš„ï¼Œæˆ‘åˆå†™äº†å»é‡ï¼Œè¿™åœ¨[downH5.cpp](https://github.com/yqylh/-Reptile/blob/master/downH5.cpp)é‡Œ æ‡’å¾—å†è¯´äº†2333ï¼‰

å¤šæ‰“å¼€å‡ æœ¬ä¹¦ï¼ŒæŸ¥çœ‹æ¥å£è°ƒç”¨å¯ä»¥å‘ç°ï¼Œæ¯æœ¬ä¹¦ä¸€å®šæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸º`'http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/'+temp+'/OEBPS/Text/chapter.xhtml'` ç„¶åæ¯æœ¬ä¹¦çš„idåŸºæœ¬éƒ½æ˜¯äº”ä½æ•°ï¼Œä»ç½‘ç«™çš„å­˜ä¹¦é‡çœ‹idä¸ä¼šè¶…è¿‡100000ï¼Œäºæ˜¯å¼€å§‹ä»0åˆ°100000å¼€å§‹æšä¸¾æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ã€‚ç¨‹åº[getCanReadList](getCanReadList.js)å¦‚ä¸‹

```js
var request = require('request');
download = (temp)=> {
    request('http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/'+temp+'/OEBPS/Text/chapter.xhtml', (err, data)=>{
        if (err) {
            console.log(err);
            return;
        }
        if (data.body != "Failed to load resource: File Not Found") {
            console.log(temp)
        }
    })
}
let i = 0;
setInterval(()=>{
    console.log(i);
    download(++i);
}, 75)
```

å¦‚æœæ—¶é—´é—´éš”å¤ªçŸ­ï¼Œè¯·æ±‚ä¼šç‚¸è£‚ï¼Œç¨‹åºå°±è·ªäº†æ‰€ä»¥è®¾ç½®äº†75msçš„æ—¶é—´é—´éš”ã€‚

#### æ‰¾åˆ°æ¯æœ¬ä¹¦çš„listï¼Œå³chapterï¼Ÿ

æˆ‘å¿˜è®°æˆ‘æ˜¯å•¥æ—¶å€™çœ‹åˆ°çš„queryAllChapterListè¿™ä¸ªæ¥å£äº†ï¼Œåº”è¯¥æ˜¯çœ‹ç½‘ç»œè¯·æ±‚çš„æ—¶å€™å‘ç°çš„ã€‚å…¶å‚æ•°ä¸ºebookidå’Œtokenï¼Œä»å…¶å¯¹åº”çš„å°±æ˜¯è¿™ä¸ªä¹¦çš„idå’Œé˜…è¯»è€…çš„ä¸€ä¸ªtokenï¼ˆçº¦1hä¼šå¤±æ•ˆï¼‰ï¼ŒåŒæ—¶è¿˜æœ‰cookieéªŒè¯ã€‚æˆ‘å¼€å§‹å°è¯•ç”¨nodeå‘é€è¿™ä¸ªè¯·æ±‚ï¼Œä½†æˆ‘å§‹ç»ˆæ‰¾ä¸åˆ°åŠæ³•è·å–tokenï¼Œäºæ˜¯æˆ‘è½¬å˜æ€è·¯ï¼Œä»å‰ç«¯å‘é€è¯·æ±‚ï¼ŒæŠŠæ¥å£æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è¾“å‡ºï¼Œåœ¨åç«¯å†è¿›è¡Œå¤„ç†ã€‚

æŒ‰F12åœ¨ä»£ç é‡Œèƒ½æ‰¾åˆ°è¿™ä¸ªæ¥å£çš„è°ƒç”¨ä»£ç ï¼Œæ ¼å¼å¤§çº¦æ˜¯(è‡ªå·±é­”æ”¹ä»¥åçš„)ï¼š

```js
ebookId = $.trim($("#ebookId").val());
token = $.trim($("#token").val());
str = ""
jQuery.ajax({
    type : "post" , 
    url : "web/refbook/queryAllChapterList", 
    dataType : "json" , 
    data : {ebookId:ebookId,token:token},
    success: (test)=>{
        test = test.data.data
        console.log(test[0].ebookName + " " + ebookId)
        str += '['
        for (i of test) {
            str += '"http://www.hzcourse.com/resource/readBook?path=' + i.ref + '",'
            var url = "resource/readBook?path="+i.ref;
            jQuery.ajax({
                type : "get" , 
                url : url,
                success: (data)=>{
                    console.log(data)
                }
            })
        }
        str += ']'
        console.log(str)
    }
});
```

è¿™ä¸ªæ¥å£è¿”å›äº†è¿™æœ¬ä¹¦æ¯ä¸ªç« èŠ‚çš„é“¾æ¥ï¼Œè¿™ä¸ªæ—¶å€™åœ¨è°ƒç”¨readBookæ¥å£å°±èƒ½æŠŠæ¯ä¸ªçš„dataé“¾æ¥èµ·æ¥ï¼Œé‡å‘½åä¸€ä¸ªhtmlï¼ŒæˆåŠŸè·å¾—è¿™æœ¬ä¹¦çš„å…¨éƒ¨æ–‡æœ¬å†…å®¹äº†ï¼Œä¹‹åè¦è€ƒè™‘è‡ªåŠ¨åŒ–çš„æ–¹å¼äº†ï¼ˆç¬‘ï¼Œå…¶å®å™©æ¢¦æ‰åˆšåˆšå¼€å§‹ã€‚

#### æ ¹æ®æ¯æœ¬ä¹¦listä¸‹è½½æ‰€æœ‰çš„XHTMLè¿æ¥æˆä¸€ä¸ªHTMLè¾“å‡º

ç”±äºXHTMLæ–‡æœ¬å†…å®¹å¾ˆå¤šï¼Œæ‰€ä»¥æ ¹æ®æˆ‘æš´åŠ›è·‘å‡ºæ¥çš„æ‰€æœ‰H5å›¾ä¹¦çš„idï¼Œå¯¹æ¯æœ¬ä¹¦è°ƒç”¨queryAllChapterListæŠŠlistè¾“å‡ºå‡ºæ¥ï¼ŒæŒ‰ç…§`[[name][list[url, url]],[name][list[url, url]]]`çš„ä¸‰ç»´æ•°ç»„çš„æ–¹å¼è¾“å‡ºï¼Œè¿™æ ·æˆ‘åªè¦æŠŠè¾“å‡ºç»“æœå¤åˆ¶è¿‡å»ï¼Œç¨åŠ ä¿®æ”¹ï¼Œå°±å˜æˆäº†ä¸‰ç»´æ•°ç»„çš„å®šä¹‰å¤åˆ¶ä»£ç äº†ã€‚

è¿™æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰çš„ä¹¦åœ¨è°ƒç”¨æ¥å£çš„æ—¶å€™è¢«æ‹’ç»è®¿é—®ï¼Œå¼€å§‹ä»¥ä¸ºå¯èƒ½æ˜¯æš´åŠ›å†™é”™äº†ï¼Œä½†æ˜¯æˆ‘ç¡®å®å¯ä»¥ä¸‹è½½é‚£ä¸ªxhtmlï¼Œæ€€ç–‘æ˜¯æœ‰çš„ä¹¦æ²¡æœ‰å¼€æ”¾é˜…è¯»ï¼Œæ— æ³•è·å–listï¼Œä½†ç¡®å®å­˜åœ¨è¿™æœ¬ä¹¦çš„æ–‡æœ¬å†…å®¹ï¼Œäºæ˜¯æˆ‘å†™äº†å¦ä¸€ä¸ªè„šæœ¬æ¥åˆ¤æ–­å…¶æ˜¯å¯ä»¥è·å–list,å¦‚æœå¯ä»¥è·å–listå°±æŒ‰ç…§ä¸Šæ–‡è¯´çš„ä¸‰ç»´æ•°ç»„å®šä¹‰çš„æ ¼å¼è¾“å‡ºã€‚

```js
mmdm = ['1136','1481','1488','1497','1500','1505','1507','1508','1515','1524','1525','1526','1527','1534','1538','1544','1545','1546','1547','1552','1550','1553','1555','1558','1559','1561','1564','1567','1568','1571','1572','1574','1629','1630','1632','1641','1646','1647','1648','1650','1654','1655','1693','1694','1695','1703','1704','1705','1708','13075','13278','13441','13743','14182','14325','14395','14505','14672','14783','14850','14875','14876','14877','14878','14881','14883','14884','14885','14886','14889','14898','14899','14900','14902','14903','14915','14914','14917','14920','14923','14934','14936','14939','14941','14943','14947','14950','14957','14958','14962','14964','14968','14971','14974','14977','14978','14988','14992','14998','14999','15005','15008','15013','15014','15015','15016','15020','15022','15023','15029','15030','15031','15033','15035','15034','15036','15037','15038','15040','15045','15047','15049','15050','15052','15054','15059','15064','15066','15070','15071','15072','15079','15082','15087','15088','15089','15092','15101','15105','15106','15107','15108','15114','15119','15121','15122','15125','15128','15132','15134','15137','15139','15140','15146','15148','15149','15153','15154','15155','15158','15161','15162','15166','15170','15174','15179','15185','15186','15188','15187','15195','15202','15207','15214','15216','15220','15257','15284','15287','15288','15290','15291','15292','15294','15295','15298','15304','15305','15306','15307','15309','15308','15310','15319','15320','15323','15324','15325','15326','15327','15328','15329','15331','15332','15336','15337','15338','15339','15341','15342','15344','15345','15346','15347','15352','15353','15358','15361','15364','15366','15369','15372','15371','15373','15376','15378','15377','15380','15384','15392','15391','15393','15394','15395','15398','15401','15403','15404','15405','15410','15413','15412','15417','15418','15421','15423','15425','15426','15427','15430','15431','15436','15439','15440','15441','15442','15444','15447','15449','15452','15453','15454','15455','15457','15456','15461','15464','15467','15468','15469','15472','15471','15489','15487','15492','15493','15495','15496','15497','15498','15501','15509','15510','15513','15516','15515','15519','15520','15524','15525','15528','15532','15534','15535','15536','15538','15541','15544','15547','15549','15554','15555','15558','15560','15570','15572','15573','15574','15575','15576','15577','15578','15579','15580','15581','15583','15586','15590','15597','15601','15603','15605','15610','15611','15615','15620','15621','15627','15629','15631','15633','15635','15636','15638','15639','15642','15644','15645','15649','15652','15653','15654','15657','15658','15663','15664','15665','15667','15669','15670','15671','15673','15678','15679','15681','15677','15676','15685','15686','15689','15699','15698','15700','15702','15701','15704','15708','15714','15717','15718','15723','15725','15728','15729','15735','15738','15740','15742','15743','15744','15746','15750','15752','15753','15755','15756','15759','15764','15765','15766','15768','15769','15770','15777','15776','15779','15781','15784','15787','15788','15794','15793','15795','15796','15803','15807','15806','15808','15818','15820','15823','15824','15826','15828','15829','15830','15832','15833','15838','15840','15845','15847','15850','15852','15857','15858','15859','15864','15866','15868','15871','15873','15876','15877','15878','15881','15882','15887','15891','15893','15897','15917','15919','15920','15921','15922','15923','15924','15925','15928','15929','15931','15932','15933','15934','15935','15936','15938','15940','15942','15943','15946','15948','15950','15951','15952','15953','15954','15956','15960','15966','15969','15977','15980','15978','15981','15982','15983','15994','15997','16000','16001','16002','16003','16007','16008','16010','16011','16012','16014','16017','16018','16020','16021','16022','16023','16024','16025','16027','15831','16033','16034','16036','16037','16038','16039','16041','16042','16045','16046','16047','16049','16057','16058','16060','16061','16063','16064','16067','16068','16073','16074','16075','16076','16077','16080','16079','16081','16082','16083','16085','16084','16086','16087','16088','16090','16092','16095','16099','16100','16101','16104','16108','16109','16110','16114','16118','16117','16119','16122','16123','16125','16136','16179','16180','16181','16183','16286','16289','16288','16291','16295','16297','16300','16302','16303','16305','16308','16309','16317','16318','16319','16320','16323','16326','16328','16329','16331','16334','16335','16337','16338','16340','16341','16344','16346','16345','16347','16350','16351','16356','16355','16357','16358','16360','16362','16363','16375','16377','16378','16379','16381','16382','16383','16384','16385','16388','16395','16396','16401','16404','16412','16411','16413','16418','16420','16421','16423','16424','16425','16429','16430','16433','16437','16440','16443','16444','16445','16446','16447','16453','16456','16467','16472','16477','16479','16478','16480','16481','16482','16488','16490','16508','16515','16524','16525','16528','16534','16535','16537','16540','16542','16545','16547','16550','16555','16569','16570','16571','16572','16575','16576','16578','16579','16463','16464','17156','17158','17163','17169','17170','17173','17174','17176','17218','17219','17222','17225','17229','17228','17230','17232','17237','17238','17239','17241','17243','17247','17251','17252','17257','17260','17261','17265','17266','17267','17271','17272','17274','17273','17280','17282','17283','17296','17297','17302','17304','17307','17331','17332','17334','17336','17338','17339','17346','17347','17352','17354','17376','17380','17381','17396','17395','17400','17405','17413','17414','17422','17429','17432','17433','17436','17437','17438','17439','17445','17447','17449','17450','17452','17459','17460','17461','17466','17467','17469','17473','17479','17480','17481','17485','17489','17497','17522','17529','17542','17549','17555','17561','17567','17576','17577','17581','17588','17589','17593','17596','17597','17609','17612','17613','17615','17619','17632','17642','17644','17652','17656','17665','17678','17679','17683','17686','17688','17691','17697','17708','17709','17710','17711','17720','17722','17729','17736','17737','17738','17746','17758','17768','17771','17775','17776','17782','17790','17795','17817','17819','17828','17829','17833','17831','17842','17844','17872','17879','17882','17883','17888','17893','17898','17905','17930','17933','17946','17950','17952','17955','17958','17966','17967','17971','17972','17973','17979','17981','17983','17986','17991','17990','17994','17996','18006','18010','18012','18013','18015','18014','18029','18041','18042','18045','18053','18052','18054','18056','18058','18062','18104','18271','18285','18356','18359','18381','18448','18464','18508','18512','18531','18532','18561','18564','18579','18588','18549']
token = $.trim($("#token").val());
out = ""
download = (id) =>{
    return new Promise((resolve, reject) =>{
        ebookId = id;
        str = ""
        jQuery.ajax({
            type : "post" , 
            url : "web/refbook/queryAllChapterList", 
            dataType : "json" , 
            data : {ebookId:ebookId,token:token},
            success: (test)=>{
                if (test.data.code == 2) {
                    resolve()
                    return;
                }
                test = test.data.data
                str += '["' + test[0].ebookName + " " + ebookId + '",'
                str += '['
                for (i of test) {
                    str += '"' + i.ref + '",'
                }
                str += ']],'
                out += str
                resolve()
            }
        });
    })
}
main = async (a, b) =>{
    for (let i = a; i < b; i++) {
        console.log(i)
        await download(mmdm[i]);
    }
}
main(0,mmdm.length)
```

ä»¥ä¸Šä¸¤æ®µä»£ç å‡åœ¨[getCanDownList](https://github.com/yqylh/-Reptile/blob/master/getCanDownList.js)é‡Œã€‚æœ€å¼€å§‹è·å–çš„æ‰€æœ‰çš„idï¼ˆ3000ä¸ªå·¦å³ï¼‰ï¼Œç­›å»ä¸èƒ½çœ‹çš„ï¼Œå‰©ä¸‹äº†800å¤šä¸ªï¼Œä¼°ç®—äº†ä¸€ä¸‹æ°å¥½+600æ˜¯ä¸€åƒå››å·¦å³ï¼Œæ°å¥½æ˜¯è®¡ç®—æœºå›¾ä¹¦çš„æ•°é‡ï¼Œéš¾é“åªæœ‰è®¡ç®—æœºçš„ä¹¦æœ‰H5é˜…è¯»çš„æ–¹å¼ï¼Ÿæˆ‘æ€€ç–‘ç½‘ç«™åœ¨ææˆ‘ã€‚

åœ¨æœ‰äº†è¿™800+ä¸ªidå¯¹åº”çš„æ‰€æœ‰ä¸‹è½½é“¾æ¥ä»¥åï¼Œå¼€å§‹å†™è„šæœ¬ä¸‹è½½è¾“å‡ºhtmlï¼Œè¿™é‡Œé¢æœ‰å¥½å¤šå‘qnqï¼Œå…ˆæŠŠ[æœ€åçš„ä»£ç ](https://github.com/yqylh/-Reptile/blob/master/downH5.js)æ”¾ä¸Šå»

```js
var request = require('request');
var fs = require('fs');

download = (temp)=> {
    return new Promise((resolve, reject) => {
        try{
            let name = temp[0].substr(0, temp[0].length - 6);
            name = name.replace(/\//g, '-');
            name = name.replace(/:/g, '-');
            let id = temp[0].substr(temp[0].length - 5, 5)
            // console.log(name, id)
            filearr = temp[1]
            let book = new Array(filearr.length)
            num = 0
            for (let i = 0; i < filearr.length; i++) {
                function getBook(k) {
                    request('http://www.hzcourse.com/resource/readBook?path='+filearr[i], (err, data)=>{
                        book[k] = data.body
                        num++
                        if (num == filearr.length) {
                            let result = ""
                            book.forEach(i=>{result += i})
                            var result1 = result.replace(/\.\./g, 'http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/' + id +'/OEBPS/Text/..');
                            var c = 'http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/' + id +'/OEBPS/Text/../Styles/main.css'
                            result = result1.replace(c, '../Styles/main.css')
                            result = result.replace(/uncompressed\/\s/g, 'uncompressed/')
                            console.log(name, id)
                            fs.writeFile(__dirname + '\\html\\' + name + '.html', result, (err)=>{
                                if (err) console.log(err);
                                resolve();
                            })
                        }
                    })
                }
                getBook(i)
            }
        } catch(err) {
            console.log(err);
            resolve()
        }
    })
}
main = async () =>{
    // å¤šçº¿ç¨‹
    // let donum = process.argv.splice(2)[0]
    // download(a[donum])
    // console.log(donum)
    // é’ˆå¯¹å•ä¸ª
    // for (let i = 0; i < a.length; i++) {
    //     if (a[i][0].indexOf('10å€é€Ÿç›®æ ‡è¾¾æˆæ³•') != -1) {
    //         await download(a[i])
    //         console.log(i)
    //     }
    // }
    // è¡¥å…¨
    // for (let i = 871; i < 874; i = i + 1) {
    //     let ans = await new Promise((resolve)=>{
    //         let name = a[i][0].substr(0, a[i][0].length - 5);
    //         let exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
    //         if (exist) {
    //             resolve(1)
    //         }
    //         name = name.replace(/\//g, '-');
    //         exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
    //         if (exist) {
    //             resolve(1)
    //         }
    //         name = name.replace(/:/g, '-');
    //         exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
    //         if (exist) {
    //             resolve(1)
    //         }
    //         resolve(0)
    //     })
    //     if (ans == 1) {
    //         console.log(i+"å·å­˜åœ¨")
    //     } else {
    //         console.log(i+"å·ä¸å­˜åœ¨ï¼Œæ­£åœ¨ä¸‹è½½")
    //         await download(a[i])
    //         console.log("ä¸‹è½½å®Œæ¯•")
    //     }
    // }
    // å…¨éƒ¨ä¸‹è½½
    // i = 795
    // setInterval(()=>{
    //     console.log(i);
    //     download(a[i++]);
    // }, 10000)
    // ä¿®å¤
    // str = "["
    // fs.readdir(__dirname + '/html2', (err, file) =>{
    //     file.forEach(files =>{
    //         for(let i = 0; i < a.length; i++) {
    //             let name = a[i][0].substr(0, a[i][0].length - 5);
    //             name = name.replace(/\//g, '-');
    //             name = name.replace(/:/g, '-');
    //             if (files.indexOf(name) != -1) {
    //                 str += i + ',';
    //                 console.log(str)
    //                 break;
    //             }
    //         }
    //     })
    // })
    // c = [496,484,747,733,390,385,315,734,722,675,816,307,727,545,409,456,305,770,644,475,118,501,407,864,786,715,417,724,673,682,847,762,656,657,758,405,854,35,548,670,423,702,794,737,503,723,795,629,728,785,744,391,712,194,463,826,678,396,274,168,606,300,823,317,718,739,835,661,667,645,840,650,710,380,568,688,551,418,602,594,788,745,658,743,649,764,584,517,481,604,323,469,476,490,590,776,852,433,663,399,735,319,570,483,485,680,245,627,720,841,642,691,515,290,586,309,301,512,779,383,304]
    // for (let i = 113; i < c.length; i++) {
    //     await download(a[c[i]])
    // }
}
main()
```

å…¶ä¸­è¿˜æœ‰açš„å®šä¹‰ï¼Œå°±æ˜¯é‚£ä¸ªä¸‰ç»´æ•°ç»„ï¼Œå®åœ¨æ˜¯å¤ªé•¿äº†ï¼Œå°±ä¸æ”¾äº†ã€‚çœ‹mainçš„å¤æ‚ç¨‹åº¦å¯ä»¥çœ‹å‡ºæˆ‘çœŸçš„å†™äº†å¥½å¤šç§æ–¹å¼â€¦â€¦å› ä¸ºè¿™ä¸ªç½‘ç«™ä»–å¤ªä¸ç¨³å®šäº†ï¼Œä¸€ä¸¢åŒ…ç¨‹åºå°±å¡ä½æˆ–è€…å´©æºƒäº†ï¼Œæ‰€ä»¥è¶…çº§çƒ¦ã€‚ä¸‹é¢æ˜¯å„ç§å‘ï¼š

1. æœ‰çš„ä¹¦ä»–çš„åå­—å«æœ‰/:è¿™ç§ç‰¹æ®Šå­—ç¬¦ï¼Œè¿™äº›åœ¨Windowsé‡Œéƒ½æ˜¯ä¸èƒ½å‡ºç°çš„ï¼Œæ‰€ä»¥æˆ‘çš„ç¨‹åºçˆ†ç‚¸äº†å¥½å¤šæ¬¡æ‰ç…§æ¸…æ¥šåŸå› ï¼Œè§£å†³æ–¹æ³•ï¼š
```js
let name = temp[0].substr(0, temp[0].length - 6);
name = name.replace(/\//g, '-');
name = name.replace(/:/g, '-');
```
åœ¨ä»ä¸‰ç»´æ•°ç»„è·å–åå­—ä»¥åï¼ŒæŠŠæ‰€æœ‰çš„/:æ›¿æ¢æˆ-
è‡³äºç©ºæ ¼ï¼Œï¼ˆå¼€å§‹çš„æ—¶å€™æˆ‘ç®—é”™äº†åå­—çš„é•¿åº¦ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åå­—éƒ½æ˜¯ä»¥ç©ºæ ¼ç»“å°¾ï¼‰ä¸ºäº†æ–¹ä¾¿ååºçš„å¤„ç†ï¼Œæˆ‘å†™äº†è„šæœ¬è¿›è¡Œrename,[mkpdf.js](https://github.com/yqylh/-Reptile/blob/master/mkpdf.js)

```js
fs.readdir(__dirname + '/temp', async (err, file) =>{
    console.log(file.length)
    file.forEach(i =>{
        // i = i.replace(/\s/g, '');
        fs.rename(__dirname + '/temp/' + i, __dirname + '/temp/' + i.replace(/\s/g, ''), err => {
            if (err) {
                console.log(err);
                return
            }
            console.log('update success')
        })
    })
})
```

2. 

```js
var fs = require('fs')
    str = "["
fs.readdir(__dirname + '/html', async (err, file) =>{
    console.log(file.length)
    file.forEach(file =>{
        let url = __dirname + '/html/' + file
        fs.readFile(url, (err, data) =>{
            if (err) {console.log(err); return;}
            if (data.indexOf('The proxy server received an invalid')!= -1) {
                for(let i = 0; i < a.length; i++) {
                    let name = a[i][0].substr(0, a[i][0].length - 6);
                    name = name.replace(/\//g, '-');
                    name = name.replace(/:/g, '-');
                    if (file.indexOf(name) != -1) {
                        str += i + ',';
                        console.log(str)
                        break;
                    }
                }
            }
        })
    })
})
```

è¿™æ®µ[è„šæœ¬](https://github.com/yqylh/-Reptile/blob/master/downH5.js)æ˜¯å› ä¸ºæœ‰çš„æ—¶å€™å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œæœ‰äº›ç« èŠ‚ä¼šä¸‹è½½å¤±è´¥ï¼Œæˆ‘éå†äº†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œå¯¹äºå«æœ‰*The proxy server received an invalid*çš„è¦é‡æ–°ä¸‹è½½ã€‚

3. åœ¨è¿æ¥æ—¶ï¼Œå› ä¸ºä¸åŒç« èŠ‚çš„è¯·æ±‚å®Œæˆçš„æ—¶é—´ä¸ä¸€å®šç›¸åŒï¼Œrequeståˆæ˜¯å¼‚æ­¥å‡½æ•°ï¼Œäºæ˜¯å†™äº†getBookè°ƒç”¨requestå‡½æ•°ï¼Œä¼ å‚æ•°kï¼Œåœ¨requestå®Œæˆåï¼ŒæŠŠç»“æœæ”¾åˆ°æ•°ç»„ç¬¬Kä¸ºï¼Œç„¶åå½“æ‰€æœ‰çš„ç»“æœéƒ½è·å–äº†ä»¥åï¼ŒæŒ‰ç…§æ•°ç»„é¡ºåºè¿èµ·æ¥ã€‚è¿™æ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªXHTMLé‡Œé¢çš„å›¾ç‰‡éƒ½ç”¨çš„ç½‘ç«™çš„ç›¸å¯¹ä½ç½®ï¼Œéœ€è¦æ ¹æ®è¯·æ±‚çš„æ¥å£å…¨éƒ½æ›¿æ¢æˆç½‘ç»œç»å¯¹ä½ç½®ï¼ˆæŒ‰ç…§æˆ‘å†™çš„ä»£ç ä¼šæŠŠcssçš„ä½ç½®ä¹Ÿæ›¿æ¢æ‰ï¼Œä½†æ˜¯æ‰€æœ‰çš„csséƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘å°±æå‰ä¸‹å¥½äº†ä¸€ä»½æ”¾åœ¨äº†Stylesæ–‡ä»¶å¤¹äº†ï¼Œæ‰€ä»¥è¿˜éœ€è¦å†æŠŠcssæ¢æˆç›¸å¯¹ä½ç½®ï¼‰ç‰¹åˆ«çš„æ˜¯ï¼Œæœ‰çš„XHTMLä¼šå‡ºç°é—®é¢˜ ä¾‹å¦‚`uncompressed \`ä¸­é—´å¤šäº†ä¸€ä¸ªç©ºæ ¼ï¼Œæ‰€ä»¥è¦å…¨éƒ½æ›¿æ¢æ‰ã€‚å…·ä½“å®ç°å¦‚ä¸‹

```js
let result = ""
book.forEach(i=>{result += i})
var result1 = result.replace(/\.\./g, 'http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/' + id +'/OEBPS/Text/..');
var c = 'http://www.hzcourse.com/resource/readBook?path=/openresources/teach_ebook/uncompressed/' + id +'/OEBPS/Text/../Styles/main.css'
result = result1.replace(c, '../Styles/main.css')
result = result.replace(/uncompressed\/\s/g, 'uncompressed/')
```

4. æœ€ç»ˆæŒ‰ç…§åå­—å†™å…¥åˆ°htmlé‡Œï¼Œå­˜åœ¨æœ¬åœ°

#### ä¿®æ­£ï¼Œå¯¼å‡ºpdf

å› ä¸ºæœ‰çš„æ—¶å€™ç½‘ç»œé—®é¢˜ï¼Œä¼šå¯¼è‡´ä¸€äº›æ–‡ä»¶æœ€åæ²¡æœ‰è¾“å‡ºï¼Œæ‰€ä»¥è¿˜éœ€è¦æŸ¥æ‰¾æ‰€æœ‰ç¼ºäº†çš„æ–‡ä»¶é‡æ–°ä¸‹è½½

```js
for (let i = 1; i < 874; i = i + 1) {
    let ans = await new Promise((resolve)=>{
        let name = a[i][0].substr(0, a[i][0].length - 5);
        let exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
        if (exist) {
            resolve(1)
        }
        name = name.replace(/\//g, '-');
        exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
        if (exist) {
            resolve(1)
        }
        name = name.replace(/:/g, '-');
        exist = fs.existsSync(__dirname + '\\html\\' + name + '.html')
        if (exist) {
            resolve(1)
        }
        resolve(0)
    })
    if (ans == 1) {
        console.log(i+"å·å­˜åœ¨")
    } else {
        console.log(i+"å·ä¸å­˜åœ¨ï¼Œæ­£åœ¨ä¸‹è½½")
        await download(a[i])
        console.log("ä¸‹è½½å®Œæ¯•")
    }
}
```

ä¸‹è½½XHTMLçš„å¤§å‘åŸºæœ¬å°±ä»¥ä¸Šï¼Œå…¶ä»–çš„æ²¡è¯´åˆ°çš„ä»£ç åŸºæœ¬æ˜¯å› ä¸ºå‘ç°äº†bugï¼Œæ‰€ä»¥è¿›è¡Œä¿®æ­£çš„ä»£ç 233ï¼Œå°±ä¸åœ¨é™ˆè¿°äº†ã€‚

å¯¹äºè¾“å‡ºpdfï¼Œæœ¬æ¥æ˜¯ç”¨çš„AdobeAcrobatè¿›è¡Œæ‰¹é‡å¯¼å‡ºï¼Œä½†æ˜¯è¿™ä¸ªåƒåœ¾è½¯ä»¶åªæœ‰32ä½ç‰ˆæœ¬ï¼Œè€Œä¸”å®ƒç»§æ‰¿äº†pspraeçš„ç‰¹æ€§ï¼Œè¶Šç”¨å ç”¨å†…å­˜è¶Šé«˜ï¼Œæ‰€ä»¥è¾“å‡ºåä¸ªå·¦å³å°±è‡ªåŠ¨å´©æºƒäº†ï¼Œæ²¡æœ‰ä»»ä½•è§£å†³åŠæ³•ã€‚ç”±äºæœ‰å…«ç™¾å¤šä¸ªHTMLï¼Œæ— æ³•ç”¨åœ¨çº¿å·¥å…·è§£å†³ï¼Œç‰¹åˆ«æ˜¯é‡Œé¢çš„å›¾ç‰‡éƒ½æ˜¯æŒ‰ç…§å›¾ç‰‡é“¾æ¥å­˜å‚¨çš„ï¼Œä¸‡ä¸€å“ªå¤©è¿™ä¸ªç½‘ç«™æ›´æ–°äº†æ¥å£å°±ggï¼Œåœ¨è¯•äº†å¾ˆå¤šç§æ–¹æ³•ä»¥å æœ€åé€‰å®šäº†wkhtmltopdfï¼Œè¿™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥è½¬æ¢pdfï¼Œéå¸¸å¥½ç”¨ï¼æœ€åçš„è„šæœ¬[mkpdf.js](mkpdf.js)ï¼Œæ§åˆ¶è¾“å‡ºæ‰€æœ‰çš„pdfã€‚

```js
var fs = require('fs')
var exec = require('child_process').exec;

fs.readdir(__dirname + '/html', async (err, file) =>{
    console.log(file.length)
    for (var i = 0; i < file.length; i++) {
        console.log('wkhtmltopdf.exe ' + __dirname + '/html/'+ file[i] + ' ' + __dirname + '/html/'+ file[i] + '.pdf')
        todo = () =>{
            return new Promise(resolve =>{
                exec('wkhtmltopdf.exe ' + __dirname + '/html/'+ file[i] + ' ' + __dirname + '/html/'+ file[i] + '.pdf', (error, stdout, stderr) => {
                    console.log(error, stdout, stderr)
                    resolve()
                })
            })
        }
        await todo();
    }
})
```

è¯·è‡ªè§‰éµå®ˆæ³•å¾‹æ³•è§„ï¼Œæœ¬è„šæœ¬ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œæ‰€æœ‰ä¸‹è½½çš„pdfè¯·åœ¨24å°æ—¶å†…åˆ é™¤ï¼Œè¯·å‹¿ä¼ æ’­æˆ–è¿›è¡Œè¥åˆ©ï¼Œä¸€åˆ‡æ³•å¾‹è´£ä»»ç”±ç”¨æˆ·è‡ªå·±æ‰¿æ‹…ï¼Œä¸æœ¬äººæ— å…³
